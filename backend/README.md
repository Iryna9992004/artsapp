# Backend Service

–û–±'—î–¥–Ω–∞–Ω–∏–π backend —Å–µ—Ä–≤—ñ—Å –¥–ª—è ArtsApp, —è–∫–∏–π –≤–∫–ª—é—á–∞—î —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å –∑:
- **auth** - –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è —Ç–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è
- **chat** - —á–∞—Ç —Ç–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è (–∑ WebSocket –ø—ñ–¥—Ç—Ä–∏–º–∫–æ—é)
- **events** - —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –ø–æ–¥—ñ—è–º–∏
- **posts** - —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –ø—É–±–ª—ñ–∫–∞—Ü—ñ—è–º–∏
- **fetch** - –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö –∑ ClickHouse (topics, events, posts)

## üöÄ –®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç

### –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π

```bash
npm install
```

### –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑–º—ñ–Ω–Ω–∏—Ö –æ—Ç–æ—á–µ–Ω–Ω—è

–°—Ç–≤–æ—Ä—ñ—Ç—å —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–µ–Ω—ñ backend –ø–∞–ø–∫–∏ –∞–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ `setup-credentials.sh` –∑ –∫–æ—Ä–µ–Ω—è –ø—Ä–æ–µ–∫—Ç—É:

```bash
cd ..
./setup-credentials.sh
```

### –ó–∞–ø—É—Å–∫ —É —Ä–µ–∂–∏–º—ñ —Ä–æ–∑—Ä–æ–±–∫–∏

```bash
npm run start:dev
```

### –ó–∞–ø—É—Å–∫ —É production —Ä–µ–∂–∏–º—ñ

```bash
npm run build
npm run start:prod
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç—É

```
backend/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ main.ts                 # –¢–æ—á–∫–∞ –≤—Ö–æ–¥—É
‚îÇ   ‚îú‚îÄ‚îÄ app.module.ts           # –ì–æ–ª–æ–≤–Ω–∏–π –º–æ–¥—É–ª—å
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ auth/                   # –ú–æ–¥—É–ª—å –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
‚îÇ   ‚îú‚îÄ‚îÄ chat/                   # –ú–æ–¥—É–ª—å —á–∞—Ç—É
‚îÇ   ‚îú‚îÄ‚îÄ events/                 # –ú–æ–¥—É–ª—å –ø–æ–¥—ñ–π
‚îÇ   ‚îú‚îÄ‚îÄ posts/                  # –ú–æ–¥—É–ª—å –ø—É–±–ª—ñ–∫–∞—Ü—ñ–π
‚îÇ   ‚îú‚îÄ‚îÄ topics/                 # –ú–æ–¥—É–ª—å —Ç–µ–º (fetch)
‚îÇ   ‚îú‚îÄ‚îÄ fetch-events/           # –ú–æ–¥—É–ª—å –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –ø–æ–¥—ñ–π (fetch)
‚îÇ   ‚îú‚îÄ‚îÄ fetch-posts/           # –ú–æ–¥—É–ª—å –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –ø—É–±–ª—ñ–∫–∞—Ü—ñ–π (fetch)
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ pg/                     # PostgreSQL –º–æ–¥—É–ª—å
‚îÇ   ‚îú‚îÄ‚îÄ redisdb/                # Redis –º–æ–¥—É–ª—å
‚îÇ   ‚îú‚îÄ‚îÄ clickhouse/             # ClickHouse –º–æ–¥—É–ª—å
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ shared/
‚îÇ       ‚îî‚îÄ‚îÄ config/             # –°–ø—ñ–ª—å–Ω–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è
‚îÇ
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ tsconfig.json
‚îú‚îÄ‚îÄ nest-cli.json
‚îî‚îÄ‚îÄ Dockerfile
```

## üîß API Endpoints

### Auth
- `POST /auth/register` - –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
- `POST /auth/login` - –í—Ö—ñ–¥
- `POST /auth/logout` - –í–∏—Ö—ñ–¥
- `POST /auth/refresh` - –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–æ–∫–µ–Ω—É

### Chat
- `POST /chat/topic` - –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–µ–º–∏
- `GET /chat/topic/:id` - –û—Ç—Ä–∏–º–∞–Ω–Ω—è —Ç–µ–º–∏
- `POST /chat/message` - –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
- `GET /chat/messages/:topicId` - –û—Ç—Ä–∏–º–∞–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
- WebSocket: `/chat` - –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ —á–∞—Ç—É

### Events
- `POST /events` - –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø–æ–¥—ñ—ó
- `GET /fetch/events` - –û—Ç—Ä–∏–º–∞–Ω–Ω—è –ø–æ–¥—ñ–π –∑ ClickHouse

### Posts
- `POST /posts/create` - –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø—É–±–ª—ñ–∫–∞—Ü—ñ—ó
- `GET /fetch/posts` - –û—Ç—Ä–∏–º–∞–Ω–Ω—è –ø—É–±–ª—ñ–∫–∞—Ü—ñ–π –∑ ClickHouse

### Topics
- `GET /fetch/topics` - –û—Ç—Ä–∏–º–∞–Ω–Ω—è —Ç–µ–º –∑ ClickHouse
- `GET /fetch/topics/search` - –ü–æ—à—É–∫ —Ç–µ–º

## üîå RabbitMQ

Backend –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î RabbitMQ –¥–ª—è —Å–ø—ñ–ª–∫—É–≤–∞–Ω–Ω—è –∑ notifications –º—ñ–∫—Ä–æ—Å–µ—Ä–≤—ñ—Å–æ–º —á–µ—Ä–µ–∑ exchange `Notification`.

## üìù –ó–º—ñ–Ω–Ω—ñ –æ—Ç–æ—á–µ–Ω–Ω—è

–î–∏–≤. `.env` —Ñ–∞–π–ª, —Å—Ç–≤–æ—Ä–µ–Ω–∏–π —á–µ—Ä–µ–∑ `setup-credentials.sh` –∞–±–æ –¥–∏–≤. `setup-credentials.sh` –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.

## üê≥ Docker

```bash
docker build -t artsapp-backend .
docker run -p 4000:4000 --env-file .env artsapp-backend
```

–ê–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ `docker-compose.prod.yml` –∑ –∫–æ—Ä–µ–Ω—è –ø—Ä–æ–µ–∫—Ç—É.
